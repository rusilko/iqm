<%= simple_form_for setup(@order_item), url: "/trainings/#{@training.id}/order_items", html: { class: 'form-inline'} do |f| %>
  <%# f.error_messages %>
  <% if f.error_notification %>
    <div class="alert alert-error fade in">
      <a class="close" data-dismiss="alert" href="#">&times;</a>
      Wystąpiły błędy w formularzu, zaznaczyliśmy je na czerwono.
    </div>
  <% end %>
  <fieldset>
    <legend>Szkolenie: <%= @training.name %>, <%= @training.start_date %> do <%= @training.end_date %>, <%= @training.city %>, <%= @training.price_per_person %>zł</legend>
    <%= f.hidden_field :productable_id, value: @training.id %>
    <%= f.hidden_field :productable_type, value: "Training" %>
    <div class="participants_table_wrapper">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th class="">#</th>
            <th class="">Name</th>
            <th class="">Email</th>
            <th class="">Tel</th>
            <th class="">Cena</th>
            <th class=""><i class="icon-trash"></i></th>
          </tr>
        </thead>
        <tbody>
          <% i = 1 %>
          <%= f.simple_fields_for :seats do |builder| %>
            <%= render 'seat_fields', f: builder, t: @training, index: i %>
          <% i+=1; end %>
        </tbody>
      </table>         
      <%= link_to_add_seat_row raw('<i class="icon-plus-sign icon-white"></i> Dodaj uczestnika'), f, :seats, i+1, @training %>
    </div>
    
    <div class="customer_wrapper">
    <%= f.simple_fields_for :order do |builder| %>
      <%= builder.input :customer_type, collection: [["Company", "Firma (faktura)"],["Client", "Osoba (rachunek)"]], label: "Dane płatnika:",
          label_method: :last, value_method: :first, as: :radio_buttons, :item_wrapper_class => 'inline', label_html: {class: "customer_name" }, :checked => "Company" %>
      <%= builder.simple_fields_for :customer, 
                html: { class: '' }, 
                defaults: { wrapper_html: {class: 'quote_field'}, 
                input_html: { class:'input-small' } } do |cbuilder| %>
        <%= field_with_prepend cbuilder, name: :name, wrapper_html_class: "address_field", input_html_class: "input-large", input_html_class: "input-large" %>
        <%= field_with_prepend cbuilder, name: :email, wrapper_html_class: "address_field", input_html_class: "input-large" %>
        <%= field_with_prepend cbuilder, name: :phone_1, prepend_text: "tel", wrapper_html_class: "address_field", input_html_class: "input-large" %>
        <%= field_with_prepend cbuilder, name: :nip, wrapper_html_class: "address_field", input_html_class: "input-large" %>
        <%= cbuilder.simple_fields_for :addresses, defaults: { wrapper_html: {class: 'address_field'}} do |abuilder| %>
          <%= render 'address_fields', f: abuilder, defaults: { sending: true, billing: true } %>
        <% end %>
        <%= link_to_add_address raw('<i class="icon-plus-sign icon-white"></i> Dodaj inny adres koresp.'), cbuilder, :addresses, { sending: true, billing: false } %>        
      <% end -%>
    <% end -%>
    </div>

    <div class="coordinator_wrapper">
    <%= f.simple_fields_for :order do |builder| %>
      <p><small>
        Koordynator to osoba, z którą będziemy się kontkować. Będzie to pierwsza osoba na liście uczestników.<br/>
        Jako adres korespondencyjny przyjmiemy adres korespondencyjny płatnika.<br/>
        Jeśli zamiawiasz szkolenia jako firma, możesz dodać nowego koordynatora i nowy adres.
      </small></p>

      <%= link_to_add_coordinator raw('<i class="icon-plus-sign icon-white"></i> Dodaj innego koordynatora'), builder, :coordinator %>        
    <% end -%>
    </div>

    <div class="form-actions">
      <%= f.submit "Zapisz na szkolenie", :class => 'btn btn-success btn-large btn-primary', id: 'create_or_update_offer_btn' %>
      <%= link_to 'Anuluj', trainings_path, :class => 'btn btn-large' %>
    </div>

  </fieldset>
<% end %>



